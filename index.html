<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <title>APEX V101 - NEURAL PATTERN EDITION</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --matrix: #00ff41; --gold: #ffd700; --bg: #010204; --hyper: #ff00ff; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: grid; grid-template-columns: 350px 1fr; height: 100vh; }
        .sidebar { background: #05080a; border-right: 2px solid var(--matrix); padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
        .main { padding: 30px; display: flex; flex-direction: column; align-items: center; overflow-y: auto; }
        
        /* Zadnjih 15 brojeva stil */
        .history-strip { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; background: #000; padding: 10px; border-radius: 8px; border: 1px solid #1a2635; }
        .hist-ball { width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; border: 1px solid #333; }
        .red { background: #ff4d4d; } .black { background: #222; } .green { background: #00ff41; color: black; }

        .terminal { background: #000; border: 2px solid var(--matrix); border-radius: 20px; padding: 25px; width: 100%; max-width: 500px; text-align: center; box-shadow: 0 0 30px rgba(0,255,65,0.1); }
        input { background: transparent; border: none; border-bottom: 4px solid var(--matrix); color: var(--matrix); font-size: 60px; width: 130px; text-align: center; outline: none; font-family: monospace; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; width: 100%; margin-top: 25px; }
        .card { padding: 20px 5px; border-radius: 12px; text-align: center; font-size: 32px; font-weight: bold; background: #0a0f14; border: 1px solid #1a2635; transition: 0.3s; }
        .active-anchor { border: 2px solid var(--hyper); color: var(--hyper); box-shadow: 0 0 20px rgba(255,0,255,0.4); transform: scale(1.05); }
        
        .btn { background: var(--matrix); color: black; border: none; padding: 18px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 15px; font-size: 18px; }
        .status-tag { font-size: 10px; letter-spacing: 2px; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="status-tag">SYSTEM: <span id="sync-status" style="color:red;">OFFLINE</span></div>
    
    <div style="background: #111; padding: 15px; border-radius: 12px; border-left: 4px solid var(--gold);">
        <span style="font-size: 11px; color: #666;">ARCHIVE TOTAL</span>
        <div id="global-count" style="font-size: 32px; color: var(--gold); font-weight: bold;">0</div>
    </div>

    <h3 style="margin-top: 30px; font-size: 12px; color: var(--matrix);">LAST 15 IN CLOUD</h3>
    <div class="history-strip" id="last15"></div>

    <div id="ai-log" style="margin-top: auto; font-size: 10px; color: #444; font-family: monospace; padding-top: 20px;"></div>
</div>

<div class="main">
    <div class="terminal">
        <h2 style="margin:0 0 15px 0; font-size: 12px; letter-spacing: 5px; color: var(--matrix);">NEURAL ENGINE V101</h2>
        <input type="number" id="numIn" placeholder="??" autofocus>
        <button class="btn" onclick="sendToCloud()">EXECUTE ANALYSIS</button>
    </div>

    <div id="prob-display" style="margin-top: 30px; font-size: 24px; font-weight: bold; color: var(--matrix);">ANALYZING...</div>
    <div class="grid" id="predictionGrid"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCf6hLEM-bysby0Oc8ftp0bNG0TrS2kkaE",
        authDomain: "apex-server-99ed8.firebaseapp.com",
        databaseURL: "https://apex-server-99ed8-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "apex-server-99ed8",
        storageBucket: "apex-server-99ed8.firebasestorage.app",
        messagingSenderId: "456350374002",
        appId: "1:456350374002:web:fe02fd3e96ce56934e4aeb"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // Inicijalna baza (tvojih 383 broja)
    const SEED = [35,8,0,7,26,1,11,6,7,36,17,19,36,6,11,3,20,27,9,7,5,4,5,24,3,31,6,3,0,13,12,13,4,4,4,12,23,16,36,15,25,7,24,34,4,28,32,6,29,21,1,34,36,34,27,25,36,17,1,4,12,13,3,15,32,19,5,27,1,7,0,7,33,33,8,3,0,31,9,0,14,31,17,26,26,36,18,36,20,2,32,33,31,18,14,19,19,6,32,8,26,1,34,18,25,24,6,10,22,15,16,5,23,30,22,27,31,9,14,1,25,5,7,15,19,28,33,21,3,24,34,25,18,27,34,11,4,28,34,26,24,24,25,8,4,34,8,16,11,34,4,26,29,3,32,11,25,23,28,6,20,12,6,29,32,33,25,21,22,31,17,26,26,36,18,36,20,2,32,33,31,18,14,19,19,6,32,8,26,1,34,18,25,24,6,10,22,15,16,5,23,30,22,27,31,9,14,14,34,31,32,4,27,1,4,23,0,34,23,13,17,29,28,12,24,5,14,1,6,16,24,35,20,7,11,8,32,20,31,3,29,27,35,11,32,19,13,8,12,3,26,28,24,25,32,22,29,7,29,36,8,32,12,22,27,9,23,17,11,27,30,8,6,36,18,17,5,15,9,22,19,1,6,4,21,28,20,3,8,21,12,16,22,36,24,9,8,34,23,2,2,11,6,11,15,8,35,22,30,27,5,31,6,30,6,25,31,19,18,34,9,7,19,16,20,19,36,10,19,2,29,5,13,14,34,27,16,29,8,17,5,0,33,17,8,5,25,23,17,14,0,5,12,36,18,16,18,7,9,33,18,23,4,9,10,28,26,27,11,34,19,35,12,20,13,25,18,34,5,17,3,8,5,6,23,28,12,18,6,27,27,10,36,18,30,13,21,35,29,23,13,24,29,5,10,19,18,10,9,23,27,4,8,35,22,2,33,18,6,5,29,25,25,25,8,21,20,12,18,27,27,15,6,4,36,22,14,23,12,8,1,35,22,30,8,16,33,24,19,8,26,26,18,19];
    let ALL_DATA = [];

    const getCol = (n) => {
        if(n === 0) return 'green';
        return [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(n) ? 'red' : 'black';
    };

    // Slušanje baze u realnom vremenu
    db.ref('roulette_history').on('value', (snap) => {
        const cloud = snap.val() || [];
        ALL_DATA = SEED.concat(cloud);
        document.getElementById('global-count').innerText = ALL_DATA.length;
        document.getElementById('sync-status').innerText = "ONLINE (CLOUD)";
        document.getElementById('sync-status').style.color = "var(--matrix)";
        
        updateHistoryDisplay(cloud.slice(-15).reverse());
        if(ALL_DATA.length > 0) runNeuralAnalysis();
    });

    function updateHistoryDisplay(last15) {
        const container = document.getElementById('last15');
        container.innerHTML = '';
        last15.forEach(n => {
            container.innerHTML += `<div class="hist-ball ${getCol(n)}">${n}</div>`;
        });
    }

    function sendToCloud() {
        let val = parseInt(document.getElementById('numIn').value);
        if(isNaN(val) || val < 0 || val > 36) return;
        
        db.ref('roulette_history').once('value', (snap) => {
            let data = snap.val() || [];
            data.push(val);
            db.ref('roulette_history').set(data);
        });
        document.getElementById('numIn').value = '';
        document.getElementById('numIn').focus();
    }

    function runNeuralAnalysis() {
        let last = ALL_DATA[ALL_DATA.length - 1];
        let weights = {}; for(let i=0; i<=36; i++) weights[i] = 0;

        // --- AI MODEL 1: MARKOV CHAIN (Prijelazi drugog reda) ---
        if(ALL_DATA.length > 3) {
            let lastTwo = ALL_DATA.slice(-2); // npr. [12, 5]
            for(let i=0; i < ALL_DATA.length - 2; i++) {
                if(ALL_DATA[i] === lastTwo[0] && ALL_DATA[i+1] === lastTwo[1]) {
                    weights[ALL_DATA[i+2]] += 100; // Ekstremno visoka težina za ponovljeni slijed od 3 broja
                }
            }
        }

        // --- AI MODEL 2: CONTEXTUAL SLIDING WINDOW (4+4) ---
        for(let i=0; i < ALL_DATA.length - 1; i++) {
            if(ALL_DATA[i] === last) {
                // Duboki kontekst 4 unazad
                if(i >= 4) {
                    let pastCtx = ALL_DATA.slice(i-4, i);
                    let currCtx = ALL_DATA.slice(-5, -1);
                    let matches = 0;
                    pastCtx.forEach((n, idx) => { if(n === currCtx[idx]) matches++; });
                    weights[ALL_DATA[i+1]] += (matches * 45);
                }
                // Prozor utjecaja 4 unaprijed
                for(let j=1; j<=4; j++) {
                    if(ALL_DATA[i+j] !== undefined) weights[ALL_DATA[i+j]] += (5 - j) * 12;
                }
            }
        }

        let sorted = Object.entries(weights).sort((a,b) => b[1] - a[1]);
        let confidence = Math.min(99, Math.floor(sorted[0][1] / 3));
        render(sorted.slice(0, 16), confidence);
    }

    function render(list, conf) {
        const g = document.getElementById('predictionGrid');
        g.innerHTML = '';
        document.getElementById('prob-display').innerText = `CONFIDENCE: ${conf}%`;
        list.forEach((item, idx) => {
            let n = item[0];
            let isHyper = idx < 6 && item[1] > 80;
            g.innerHTML += `<div class="card ${isHyper ? 'active-anchor' : ''}">${n}</div>`;
        });
    }
</script>
    <div id="old-data-recovery" style="background:white; color:black; padding:20px; position:fixed; top:0; z-index:9999; width:100%; height:100vh; overflow:auto;">
    <h2>TVOJI STARI BROJEVI (LOCALSTORAGE):</h2>
    <pre id="display-old"></pre>
    <button onclick="document.getElementById('old-data-recovery').remove()">ZATVORI</button>
</div>
<script>
  
</script>
</body>
</html>


